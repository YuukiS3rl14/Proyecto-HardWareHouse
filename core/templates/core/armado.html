{% extends 'core/base.html' %}
{% load static %}

{% block tittle %} Armado de PC {% endblock %}

{% block extra_head %}
<!-- Select2 CSS -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
<style>
    .component-card-wrapper {
        display: flex;
        height: 100%;
    }
    .component-card {
        display: flex;
        border: 1px solid #dee2e6;
        border-radius: .25rem;
        padding: 1rem;
        align-items: center;
        background-color: #fff;
        transition: box-shadow .2s ease-in-out;
        width: 100%;
        flex-direction: column;
    }
    .component-card:hover {
        box-shadow: 0 .125rem .25rem rgba(0,0,0,.075);
    }
    .component-card img {
        width: 80px;
        height: 80px;
        object-fit: contain;
        margin-top: 1rem;
        margin-bottom: 1rem;
    }
    .component-card .info {
        flex-grow: 1;
        text-align: center;
        width: 100%;
    }
    .component-card .info h5 {
        margin-bottom: 0.25rem;
    }
    .component-card .info .spec-list {
        font-size: 0.85rem;
        color: #6c757d;
    }
    .component-card .actions {
        text-align: center;
        width: 100%;
        padding-top: 1rem;
        margin-top: auto; /* Empuja las acciones hacia abajo */
    }
    .modal-body .list-group-item {
        cursor: pointer;
    }
    .modal-body .list-group-item:hover {
        background-color: #f8f9fa;
    }
    .modal-body .list-group-item.disabled {
        background-color: #f8d7da;
        cursor: not-allowed;
    }
</style>
{% endblock %}

{% block principal %}
<!-- Page Header Start -->
<div class="container-fluid bg-light mb-5">
    <div class="d-flex flex-column align-items-center justify-content-center" style="min-height: 250px">
        <h1 class="font-weight-semi-bold text-uppercase mb-3">Arma tu PC</h1>
        <p class="text-muted">Selecciona los componentes y obtén un presupuesto al instante.</p>
    </div>
</div>
<!-- Page Header End -->

<div class="container-fluid">
    <div class="row px-xl-5">
        <!-- Columna de Selección de Componentes -->
        <div class="col-lg-9">
            <div id="pc-builder">
                <!-- Las tarjetas de componentes se generarán aquí con JS en una rejilla -->
            </div>
        </div>

        <!-- Columna de Resumen y Presupuesto -->
        <div class="col-lg-3">
            <div class="card border-success mb-5">
                <div class="card-header bg-success border-success">
                    <h4 class="font-weight-semi-bold m-0 text-white">Resumen del Presupuesto</h4>
                </div>
                <div class="card-body">
                    <div id="summary-list">
                        <!-- El resumen de componentes se generará aquí -->
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between mt-2">
                        <h5 class="font-weight-bold">Total</h5>
                        <h5 class="font-weight-bold" id="total-price">$0</h5>
                    </div>
                </div>
                <div class="card-footer border-secondary bg-transparent">
                    <button id="add-to-cart-btn" class="btn btn-block btn-success my-2 py-3" disabled>
                        <i class="fa fa-shopping-cart mr-1"></i> Añadir al Carrito
                    </button>
                    <button id="download-excel-btn" class="btn btn-block btn-outline-success my-2 py-3" disabled>
                        <i class="fa fa-file-excel mr-1"></i> Descargar Excel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

{{ componentes|json_script:"componentes-data" }}

<div id="builder-urls" data-add-to-cart-url="{% url 'agregar_al_carrito' %}" data-placeholder-img="{% static 'core/img/placeholder_product.webp' %}" style="display: none;"></div>

<!-- Modal para seleccionar componentes -->
<div class="modal fade" id="componentModal" tabindex="-1" aria-labelledby="componentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="componentModalLabel">Seleccionar Componente</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="componentModalBody">
                <!-- La lista de componentes se cargará aquí -->
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_scripts %}
<!-- Select2 JS -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<!-- SheetJS (js-xlsx) para generar Excel -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script> 
<!-- Nuestro script para el constructor -->
<script src="{% static 'core/js/pc-builder.js' %}"></script>
{% endblock %}
